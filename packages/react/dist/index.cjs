"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const l=require("react"),gr=require("@snap-studio/core"),mr=require("@snap-studio/expression-engine");function ze(r={}){const t=l.useRef(null),s=l.useRef(null),[x,f]=l.useState(!1),[_,p]=l.useState(!1),[d,i]=l.useState(null);l.useEffect(()=>(t.current||(s.current=new mr.ExpressionEngine(r.expressionEngine),t.current=gr.createRenderEngine(s.current,r),r.debug&&console.log("RenderEngine created:",t.current)),()=>{t.current&&(t.current.destroy().catch(console.error),t.current=null,s.current=null,f(!1))}),[]);const g=l.useCallback(async c=>{if(!t.current)throw new Error("渲染引擎未创建");p(!0),i(null);try{const E=await t.current.initialize(c);return E.success?(f(!0),r.debug&&console.log("页面初始化成功:",E)):(i(E.error||"初始化失败"),r.debug&&console.error("页面初始化失败:",E.error)),E}catch(E){const w=E instanceof Error?E.message:"初始化异常";return i(w),r.debug&&console.error("页面初始化异常:",E),{success:!1,duration:0,error:w,loadedDataSources:0,registeredComponents:0}}finally{p(!1)}},[r.debug]),a=l.useCallback(async()=>{t.current&&(await t.current.destroy(),f(!1),i(null))},[]),j=l.useCallback(()=>{var c;return((c=t.current)==null?void 0:c.getStats())||null},[]);return{engine:t.current,initializePage:g,isInitialized:x,isInitializing:_,initError:d,destroy:a,getStats:j}}function br(r,t,s){const[x,f]=l.useState(()=>{if(!r)return s;const a=r.get(t);return a!==void 0?a:s}),[_,p]=l.useState(!r);l.useEffect(()=>{if(!r){p(!0);return}p(!1);const a=r.get(t);a!==void 0&&f(a);const j=r.subscribe(t,(c,E,w)=>{if(w===t||w.startsWith(t+".")||t.startsWith(w+".")){const O=r.get(t);f(O!==void 0?O:s)}});return()=>{r.unsubscribe(j)}},[r,t,s]);const d=l.useCallback(a=>{if(!r){console.warn("StateManager not available");return}r.set(t,a)},[r,t]),i=l.useCallback(a=>{if(!r){console.warn("StateManager not available");return}typeof a=="object"&&a!==null?r.merge(t,a):console.warn("mergeValue only works with object values")},[r,t]),g=l.useCallback(()=>{if(!r){console.warn("StateManager not available");return}r.delete(t)},[r,t]);return{value:x,setValue:d,mergeValue:i,deleteValue:g,isLoading:_}}function Le(r,t,s){const[x,f]=l.useState(()=>{if(!r)return s||{};const i={};return t.forEach(g=>{const a=r.get(g);i[g]=a!==void 0?a:s==null?void 0:s[g]}),i}),[_,p]=l.useState(!r);l.useEffect(()=>{if(!r){p(!0);return}p(!1);const i=[];return t.forEach(g=>{const a=r.subscribe(g,()=>{const j={};t.forEach(c=>{const E=r.get(c);j[c]=E!==void 0?E:s==null?void 0:s[c]}),f(j)});i.push(a)}),()=>{i.forEach(g=>{r.unsubscribe(g)})}},[r,JSON.stringify(t),JSON.stringify(s)]);const d=l.useCallback(i=>{if(!r){console.warn("StateManager not available");return}Object.entries(i).forEach(([g,a])=>{t.includes(g)&&r.set(g,a)})},[r,t]);return{states:x,setStates:d,isLoading:_}}function Ye(r,t={}){const{maxHistory:s=50,autoClearError:x=!0,errorClearDelay:f=5e3}=t,[_,p]=l.useState({isExecuting:!1,lastResult:null,error:null,history:[]}),d=l.useCallback(async(a,j={})=>{if(!r){const c={actionId:a,success:!1,error:"ActionExecutor not available"};return p(E=>({...E,lastResult:c,error:c.error||null})),c}p(c=>({...c,isExecuting:!0,error:null}));try{const c=await r.execute(a,j);return p(E=>{const w=[...E.history,c];return w.length>s&&w.splice(0,w.length-s),{...E,isExecuting:!1,lastResult:c,error:c.success?null:c.error||"执行失败",history:w}}),!c.success&&x&&setTimeout(()=>{p(E=>({...E,error:null}))},f),c}catch(c){const E=c instanceof Error?c.message:"执行异常",w={actionId:a,success:!1,error:E};return p(O=>({...O,isExecuting:!1,lastResult:w,error:E,history:[...O.history,w]})),x&&setTimeout(()=>{p(O=>({...O,error:null}))},f),w}},[r,s,x,f]),i=l.useCallback(()=>{p(a=>({...a,history:[],error:null}))},[]),g=l.useCallback(async()=>{const a=_.lastResult;return!a||a.success?null:await d(a.actionId,{isRetry:!0})},[_.lastResult,d]);return{execute:d,state:_,clearHistory:i,retryLast:g}}function hr(r){const[t,s]=l.useState(!1),[x,f]=l.useState([]);return{executeBatch:l.useCallback(async p=>{if(!r)return p.map(d=>({actionId:d.id,success:!1,error:"ActionExecutor not available"}));s(!0);try{const d=p.map(g=>r.execute(g.id,g.context)),i=await Promise.all(d);return f(i),i}finally{s(!1)}},[r]),isExecuting:t,results:x}}var de={exports:{}},J={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Be;function xr(){if(Be)return J;Be=1;var r=l,t=Symbol.for("react.element"),s=Symbol.for("react.fragment"),x=Object.prototype.hasOwnProperty,f=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,_={key:!0,ref:!0,__self:!0,__source:!0};function p(d,i,g){var a,j={},c=null,E=null;g!==void 0&&(c=""+g),i.key!==void 0&&(c=""+i.key),i.ref!==void 0&&(E=i.ref);for(a in i)x.call(i,a)&&!_.hasOwnProperty(a)&&(j[a]=i[a]);if(d&&d.defaultProps)for(a in i=d.defaultProps,i)j[a]===void 0&&(j[a]=i[a]);return{$$typeof:t,type:d,key:c,ref:E,props:j,_owner:f.current}}return J.Fragment=s,J.jsx=p,J.jsxs=p,J}var q={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var We;function Er(){return We||(We=1,process.env.NODE_ENV!=="production"&&function(){var r=l,t=Symbol.for("react.element"),s=Symbol.for("react.portal"),x=Symbol.for("react.fragment"),f=Symbol.for("react.strict_mode"),_=Symbol.for("react.profiler"),p=Symbol.for("react.provider"),d=Symbol.for("react.context"),i=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),a=Symbol.for("react.suspense_list"),j=Symbol.for("react.memo"),c=Symbol.for("react.lazy"),E=Symbol.for("react.offscreen"),w=Symbol.iterator,O="@@iterator";function m(e){if(e===null||typeof e!="object")return null;var n=w&&e[w]||e[O];return typeof n=="function"?n:null}var h=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function R(e){{for(var n=arguments.length,o=new Array(n>1?n-1:0),u=1;u<n;u++)o[u-1]=arguments[u];I("error",e,o)}}function I(e,n,o){{var u=h.ReactDebugCurrentFrame,S=u.getStackAddendum();S!==""&&(n+="%s",o=o.concat([S]));var C=o.map(function(b){return String(b)});C.unshift("Warning: "+n),Function.prototype.apply.call(console[e],console,C)}}var F=!1,M=!1,K=!1,G=!1,pe=!1,V;V=Symbol.for("react.module.reference");function $(e){return!!(typeof e=="string"||typeof e=="function"||e===x||e===_||pe||e===f||e===g||e===a||G||e===E||F||M||K||typeof e=="object"&&e!==null&&(e.$$typeof===c||e.$$typeof===j||e.$$typeof===p||e.$$typeof===d||e.$$typeof===i||e.$$typeof===V||e.getModuleId!==void 0))}function X(e,n,o){var u=e.displayName;if(u)return u;var S=n.displayName||n.name||"";return S!==""?o+"("+S+")":o}function W(e){return e.displayName||"Context"}function B(e){if(e==null)return null;if(typeof e.tag=="number"&&R("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case x:return"Fragment";case s:return"Portal";case _:return"Profiler";case f:return"StrictMode";case g:return"Suspense";case a:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case d:var n=e;return W(n)+".Consumer";case p:var o=e;return W(o._context)+".Provider";case i:return X(e,e.render,"ForwardRef");case j:var u=e.displayName||null;return u!==null?u:B(e.type)||"Memo";case c:{var S=e,C=S._payload,b=S._init;try{return B(b(C))}catch{return null}}}return null}var z=Object.assign,H=0,ve,ye,ge,me,be,he,xe;function Ee(){}Ee.__reactDisabledLog=!0;function Me(){{if(H===0){ve=console.log,ye=console.info,ge=console.warn,me=console.error,be=console.group,he=console.groupCollapsed,xe=console.groupEnd;var e={configurable:!0,enumerable:!0,value:Ee,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}H++}}function Ve(){{if(H--,H===0){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:z({},e,{value:ve}),info:z({},e,{value:ye}),warn:z({},e,{value:ge}),error:z({},e,{value:me}),group:z({},e,{value:be}),groupCollapsed:z({},e,{value:he}),groupEnd:z({},e,{value:xe})})}H<0&&R("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var oe=h.ReactCurrentDispatcher,se;function Z(e,n,o){{if(se===void 0)try{throw Error()}catch(S){var u=S.stack.trim().match(/\n( *(at )?)/);se=u&&u[1]||""}return`
`+se+e}}var ie=!1,Q;{var He=typeof WeakMap=="function"?WeakMap:Map;Q=new He}function Se(e,n){if(!e||ie)return"";{var o=Q.get(e);if(o!==void 0)return o}var u;ie=!0;var S=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var C;C=oe.current,oe.current=null,Me();try{if(n){var b=function(){throw Error()};if(Object.defineProperty(b.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(b,[])}catch(D){u=D}Reflect.construct(e,[],b)}else{try{b.call()}catch(D){u=D}e.call(b.prototype)}}else{try{throw Error()}catch(D){u=D}e()}}catch(D){if(D&&u&&typeof D.stack=="string"){for(var v=D.stack.split(`
`),P=u.stack.split(`
`),k=v.length-1,T=P.length-1;k>=1&&T>=0&&v[k]!==P[T];)T--;for(;k>=1&&T>=0;k--,T--)if(v[k]!==P[T]){if(k!==1||T!==1)do if(k--,T--,T<0||v[k]!==P[T]){var A=`
`+v[k].replace(" at new "," at ");return e.displayName&&A.includes("<anonymous>")&&(A=A.replace("<anonymous>",e.displayName)),typeof e=="function"&&Q.set(e,A),A}while(k>=1&&T>=0);break}}}finally{ie=!1,oe.current=C,Ve(),Error.prepareStackTrace=S}var N=e?e.displayName||e.name:"",L=N?Z(N):"";return typeof e=="function"&&Q.set(e,L),L}function Ue(e,n,o){return Se(e,!1)}function Je(e){var n=e.prototype;return!!(n&&n.isReactComponent)}function ee(e,n,o){if(e==null)return"";if(typeof e=="function")return Se(e,Je(e));if(typeof e=="string")return Z(e);switch(e){case g:return Z("Suspense");case a:return Z("SuspenseList")}if(typeof e=="object")switch(e.$$typeof){case i:return Ue(e.render);case j:return ee(e.type,n,o);case c:{var u=e,S=u._payload,C=u._init;try{return ee(C(S),n,o)}catch{}}}return""}var U=Object.prototype.hasOwnProperty,Re={},Ce=h.ReactDebugCurrentFrame;function re(e){if(e){var n=e._owner,o=ee(e.type,e._source,n?n.type:null);Ce.setExtraStackFrame(o)}else Ce.setExtraStackFrame(null)}function qe(e,n,o,u,S){{var C=Function.call.bind(U);for(var b in e)if(C(e,b)){var v=void 0;try{if(typeof e[b]!="function"){var P=Error((u||"React class")+": "+o+" type `"+b+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof e[b]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw P.name="Invariant Violation",P}v=e[b](n,b,u,o,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(k){v=k}v&&!(v instanceof Error)&&(re(S),R("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",u||"React class",o,b,typeof v),re(null)),v instanceof Error&&!(v.message in Re)&&(Re[v.message]=!0,re(S),R("Failed %s type: %s",o,v.message),re(null))}}}var Ke=Array.isArray;function ae(e){return Ke(e)}function Ge(e){{var n=typeof Symbol=="function"&&Symbol.toStringTag,o=n&&e[Symbol.toStringTag]||e.constructor.name||"Object";return o}}function Xe(e){try{return _e(e),!1}catch{return!0}}function _e(e){return""+e}function je(e){if(Xe(e))return R("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",Ge(e)),_e(e)}var we=h.ReactCurrentOwner,Ze={key:!0,ref:!0,__self:!0,__source:!0},ke,Te;function Qe(e){if(U.call(e,"ref")){var n=Object.getOwnPropertyDescriptor(e,"ref").get;if(n&&n.isReactWarning)return!1}return e.ref!==void 0}function er(e){if(U.call(e,"key")){var n=Object.getOwnPropertyDescriptor(e,"key").get;if(n&&n.isReactWarning)return!1}return e.key!==void 0}function rr(e,n){typeof e.ref=="string"&&we.current}function tr(e,n){{var o=function(){ke||(ke=!0,R("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",n))};o.isReactWarning=!0,Object.defineProperty(e,"key",{get:o,configurable:!0})}}function nr(e,n){{var o=function(){Te||(Te=!0,R("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",n))};o.isReactWarning=!0,Object.defineProperty(e,"ref",{get:o,configurable:!0})}}var or=function(e,n,o,u,S,C,b){var v={$$typeof:t,type:e,key:n,ref:o,props:b,_owner:C};return v._store={},Object.defineProperty(v._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(v,"_self",{configurable:!1,enumerable:!1,writable:!1,value:u}),Object.defineProperty(v,"_source",{configurable:!1,enumerable:!1,writable:!1,value:S}),Object.freeze&&(Object.freeze(v.props),Object.freeze(v)),v};function sr(e,n,o,u,S){{var C,b={},v=null,P=null;o!==void 0&&(je(o),v=""+o),er(n)&&(je(n.key),v=""+n.key),Qe(n)&&(P=n.ref,rr(n,S));for(C in n)U.call(n,C)&&!Ze.hasOwnProperty(C)&&(b[C]=n[C]);if(e&&e.defaultProps){var k=e.defaultProps;for(C in k)b[C]===void 0&&(b[C]=k[C])}if(v||P){var T=typeof e=="function"?e.displayName||e.name||"Unknown":e;v&&tr(b,T),P&&nr(b,T)}return or(e,v,P,S,u,we.current,b)}}var le=h.ReactCurrentOwner,Oe=h.ReactDebugCurrentFrame;function Y(e){if(e){var n=e._owner,o=ee(e.type,e._source,n?n.type:null);Oe.setExtraStackFrame(o)}else Oe.setExtraStackFrame(null)}var ue;ue=!1;function ce(e){return typeof e=="object"&&e!==null&&e.$$typeof===t}function Pe(){{if(le.current){var e=B(le.current.type);if(e)return`

Check the render method of \``+e+"`."}return""}}function ir(e){return""}var Ie={};function ar(e){{var n=Pe();if(!n){var o=typeof e=="string"?e:e.displayName||e.name;o&&(n=`

Check the top-level render call using <`+o+">.")}return n}}function De(e,n){{if(!e._store||e._store.validated||e.key!=null)return;e._store.validated=!0;var o=ar(n);if(Ie[o])return;Ie[o]=!0;var u="";e&&e._owner&&e._owner!==le.current&&(u=" It was passed a child from "+B(e._owner.type)+"."),Y(e),R('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',o,u),Y(null)}}function Ae(e,n){{if(typeof e!="object")return;if(ae(e))for(var o=0;o<e.length;o++){var u=e[o];ce(u)&&De(u,n)}else if(ce(e))e._store&&(e._store.validated=!0);else if(e){var S=m(e);if(typeof S=="function"&&S!==e.entries)for(var C=S.call(e),b;!(b=C.next()).done;)ce(b.value)&&De(b.value,n)}}}function lr(e){{var n=e.type;if(n==null||typeof n=="string")return;var o;if(typeof n=="function")o=n.propTypes;else if(typeof n=="object"&&(n.$$typeof===i||n.$$typeof===j))o=n.propTypes;else return;if(o){var u=B(n);qe(o,e.props,"prop",u,e)}else if(n.PropTypes!==void 0&&!ue){ue=!0;var S=B(n);R("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",S||"Unknown")}typeof n.getDefaultProps=="function"&&!n.getDefaultProps.isReactClassApproved&&R("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function ur(e){{for(var n=Object.keys(e.props),o=0;o<n.length;o++){var u=n[o];if(u!=="children"&&u!=="key"){Y(e),R("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",u),Y(null);break}}e.ref!==null&&(Y(e),R("Invalid attribute `ref` supplied to `React.Fragment`."),Y(null))}}var Fe={};function $e(e,n,o,u,S,C){{var b=$(e);if(!b){var v="";(e===void 0||typeof e=="object"&&e!==null&&Object.keys(e).length===0)&&(v+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var P=ir();P?v+=P:v+=Pe();var k;e===null?k="null":ae(e)?k="array":e!==void 0&&e.$$typeof===t?(k="<"+(B(e.type)||"Unknown")+" />",v=" Did you accidentally export a JSX literal instead of a component?"):k=typeof e,R("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",k,v)}var T=sr(e,n,o,S,C);if(T==null)return T;if(b){var A=n.children;if(A!==void 0)if(u)if(ae(A)){for(var N=0;N<A.length;N++)Ae(A[N],e);Object.freeze&&Object.freeze(A)}else R("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else Ae(A,e)}if(U.call(n,"key")){var L=B(e),D=Object.keys(n).filter(function(yr){return yr!=="key"}),fe=D.length>0?"{key: someKey, "+D.join(": ..., ")+": ...}":"{key: someKey}";if(!Fe[L+fe]){var vr=D.length>0?"{"+D.join(": ..., ")+": ...}":"{}";R(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,fe,L,vr,L),Fe[L+fe]=!0}}return e===x?ur(T):lr(T),T}}function cr(e,n,o){return $e(e,n,o,!0)}function fr(e,n,o){return $e(e,n,o,!1)}var dr=fr,pr=cr;q.Fragment=x,q.jsx=dr,q.jsxs=pr}()),q}process.env.NODE_ENV==="production"?de.exports=xr():de.exports=Er();var y=de.exports;class te extends l.Component{constructor(t){super(t),this.state={hasError:!1}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,s){this.setState({error:t,errorInfo:s}),this.props.onError&&this.props.onError(t,s),process.env.NODE_ENV==="development"&&(console.group("🚨 Component Error Boundary"),console.error("Error:",t),console.error("Error Info:",s),this.props.componentId&&console.error("Component ID:",this.props.componentId),this.props.componentType&&console.error("Component Type:",this.props.componentType),console.groupEnd())}render(){var t,s;if(this.state.hasError){if(this.props.fallback)return this.props.fallback(this.state.error,this.state.errorInfo);const x={display:"flex",alignItems:"center",justifyContent:"center",minHeight:"200px",padding:"20px",backgroundColor:"#fff2f0",border:"2px dashed #ff4d4f",borderRadius:"8px",margin:"10px 0"},f={textAlign:"center",maxWidth:"600px"},_={color:"#ff4d4f",margin:"0 0 16px 0",fontSize:"18px"},p={background:"white",padding:"12px",borderRadius:"4px",margin:"16px 0",textAlign:"left"},d={margin:"4px 0",fontSize:"14px"},i={margin:"16px 0",textAlign:"left"},g={background:"#f5f5f5",padding:"12px",borderRadius:"4px",maxHeight:"300px",overflow:"auto"},a={margin:"0",fontSize:"12px",whiteSpace:"pre-wrap",wordBreak:"break-all"},j={background:"#1890ff",color:"white",border:"none",padding:"8px 16px",borderRadius:"4px",cursor:"pointer",fontSize:"14px",marginTop:"16px"};return y.jsx("div",{style:x,children:y.jsxs("div",{style:f,children:[y.jsx("h3",{style:_,children:"⚠️ 组件渲染出错"}),y.jsxs("div",{style:p,children:[this.props.componentType&&y.jsxs("p",{style:d,children:[y.jsx("strong",{children:"组件类型:"})," ",this.props.componentType]}),this.props.componentId&&y.jsxs("p",{style:d,children:[y.jsx("strong",{children:"组件ID:"})," ",this.props.componentId]})]}),(this.props.showErrorDetails||process.env.NODE_ENV==="development")&&y.jsxs("details",{style:i,children:[y.jsx("summary",{style:{cursor:"pointer",fontWeight:"bold",marginBottom:"8px"},children:"错误详情"}),y.jsxs("div",{style:g,children:[y.jsx("pre",{style:a,children:(t=this.state.error)==null?void 0:t.stack}),((s=this.state.errorInfo)==null?void 0:s.componentStack)&&y.jsxs("div",{children:[y.jsx("h4",{style:{margin:"16px 0 8px 0"},children:"组件栈:"}),y.jsx("pre",{style:a,children:this.state.errorInfo.componentStack})]})]})]}),y.jsx("button",{style:j,onMouseEnter:c=>{c.target.style.background="#40a9ff"},onMouseLeave:c=>{c.target.style.background="#1890ff"},onClick:()=>this.setState({hasError:!1,error:void 0,errorInfo:void 0}),children:"重试渲染"})]})})}return this.props.children}}function Sr(){const[,r]=l.useState(),t=l.useCallback(()=>{r({})},[]),s=l.useCallback(x=>{r(()=>{throw x})},[]);return{resetError:t,captureError:s}}function ne({engine:r,definition:t,componentId:s,extraProps:x={},enableErrorBoundary:f=!0}){const{execute:_}=Ye(r.actionExecutor),p=r.componentRegistry.get(t.componentType),d=l.useMemo(()=>t.dataBinding?Object.entries(t.dataBinding).filter(([m,h])=>typeof h=="string").map(([m,h])=>({propName:m,dataPath:h})):[],[t.dataBinding]),{states:i}=Le(r.stateManager,d.map(m=>m.dataPath),{}),g=l.useMemo(()=>{if(!t.dataBinding)return{};const m={};return d.forEach(({propName:h,dataPath:R})=>{m[h]=i[R]}),Object.entries(t.dataBinding).forEach(([h,R])=>{typeof R=="object"&&(m[h]=R)}),m},[t.dataBinding,d,i]),a=l.useMemo(()=>{if(!t.dynamicProps)return{};const m={};return Object.entries(t.dynamicProps).forEach(([h,R])=>{var I;try{const F={state:r.stateManager.get()},M=(I=r.stateManager.expressionEngine)==null?void 0:I.evaluateSync(R,F);m[h]=M}catch(F){console.warn(`动态属性计算失败: ${h}`,F),m[h]=void 0}}),m},[t.dynamicProps,r.stateManager]),j=l.useMemo(()=>{if(!t.events)return{};const m={};return Object.entries(t.events).forEach(([h,R])=>{m[h]=async I=>{try{await _(R,{event:I,target:I.target,payload:{componentId:s,eventName:h}})}catch(F){console.error(`事件处理失败: ${h}`,F)}}}),m},[t.events,_,s]),c=l.useMemo(()=>{var m;if(!t.visibility)return!0;try{const h={state:r.stateManager.get()};return!!((m=r.stateManager.expressionEngine)!=null&&m.evaluateSync(t.visibility,h))}catch(h){return console.warn("可见性条件计算失败:",h),!0}},[t.visibility,r.stateManager]),E=l.useCallback(()=>{if(t.children)return t.children.map((m,h)=>{var R;if(typeof m=="string"){const I=(R=r.getCurrentSchema())==null?void 0:R.components[m];return I?l.createElement(ne,{key:m,engine:r,definition:I,componentId:m,enableErrorBoundary:f}):(console.warn(`子组件未找到: ${m}`),null)}else return typeof m=="object"?l.createElement(ne,{key:`inline-${h}`,engine:r,definition:m,componentId:`${s}-child-${h}`,enableErrorBoundary:f}):m})},[t.children,r,s,f]);if(!c)return null;if(!p){const m=()=>l.createElement("div",{style:{padding:"16px",border:"2px dashed #ff4d4f",borderRadius:"4px",backgroundColor:"#fff2f0",color:"#ff4d4f"}},l.createElement("strong",null,`组件类型未注册: ${t.componentType}`),s&&l.createElement("div",null,`组件ID: ${s}`));return f?l.createElement(te,{componentId:s,componentType:t.componentType},l.createElement(m)):l.createElement(m)}const w={...t.properties||t.props||{},...g,...a,...j,...x,children:E()},O=l.createElement(p,w);return f?l.createElement(te,{componentId:s,componentType:t.componentType},O):O}function Rr({componentType:r,properties:t={},children:s,componentRegistry:x}){const f=x.get(r);return f?l.createElement(f,{...t,children:s}):l.createElement("div",{style:{color:"red"}},`Unknown component: ${r}`)}const Cr=({progress:r,message:t="页面加载中..."})=>{const s={display:"flex",alignItems:"center",justifyContent:"center",minHeight:"200px",padding:"40px 20px"},x={textAlign:"center",maxWidth:"300px"},f={width:"40px",height:"40px",border:"4px solid #f3f3f3",borderTop:"4px solid #1890ff",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 16px"},_={color:"#666",fontSize:"16px",marginBottom:"16px"},p={width:"100%",height:"4px",backgroundColor:"#f3f3f3",borderRadius:"2px",overflow:"hidden"},d={height:"100%",backgroundColor:"#1890ff",transition:"width 0.3s ease",width:`${r||0}%`};return y.jsxs("div",{style:s,children:[y.jsxs("div",{style:x,children:[y.jsx("div",{style:f}),y.jsx("div",{style:_,children:t}),typeof r=="number"&&y.jsx("div",{style:p,children:y.jsx("div",{style:d})})]}),y.jsx("style",{children:`
          @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
          }
        `})]})},_r=({error:r,onRetry:t})=>{const s={display:"flex",alignItems:"center",justifyContent:"center",minHeight:"300px",padding:"40px 20px"},x={textAlign:"center",maxWidth:"400px"},f={fontSize:"48px",marginBottom:"16px"},_={color:"#ff4d4f",margin:"0 0 16px 0",fontSize:"20px"},p={color:"#666",fontSize:"14px",lineHeight:"1.5",marginBottom:"24px",background:"#f5f5f5",padding:"12px",borderRadius:"4px",textAlign:"left"},d={background:"#1890ff",color:"white",border:"none",padding:"12px 24px",borderRadius:"4px",cursor:"pointer",fontSize:"14px"};return y.jsx("div",{style:s,children:y.jsxs("div",{style:x,children:[y.jsx("div",{style:f,children:"⚠️"}),y.jsx("h3",{style:_,children:"页面加载失败"}),y.jsx("div",{style:p,children:r}),t&&y.jsx("button",{style:d,onMouseEnter:i=>{i.target.style.background="#40a9ff"},onMouseLeave:i=>{i.target.style.background="#1890ff"},onClick:t,children:"重新加载"})]})})};function Ne({schema:r,engineConfig:t={},loadingComponent:s=Cr,errorComponent:x=_r,enableErrorBoundary:f=!0,className:_,style:p,onPageLoad:d,onPageError:i,onPageUnload:g}){const{engine:a,initializePage:j,isInitialized:c,isInitializing:E,initError:w,destroy:O}=ze(t),[m,h]=l.useState(0),[R,I]=l.useState("正在初始化页面...");l.useEffect(()=>{let $=!0;return(async()=>{if(!(!r||!a))try{I("正在加载页面配置..."),h(20);const W=await j(r);if(!$)return;W.success?(h(100),I("加载完成"),d==null||d(r)):i==null||i(W.error||"页面初始化失败")}catch(W){if(!$)return;const B=W instanceof Error?W.message:"未知错误";i==null||i(B)}})(),()=>{$=!1}},[r,a,j,d,i]),l.useEffect(()=>()=>{r&&(g==null||g(r)),O()},[r,O,g]);const F=l.useMemo(()=>{if(!r||!c)return null;const $=r.layout.root;return r.components[$]},[r,c]),M=()=>{r&&a&&(h(0),I("正在重新加载..."),j(r))},K={width:"100%",minHeight:"100vh",...p},G=["snap-studio-page-container",r!=null&&r.metadata.pageId?`page-${r.metadata.pageId}`:"",_||""].filter(Boolean).join(" "),V=w?y.jsx(x,{error:w,onRetry:M}):E||!c?y.jsx(s,{progress:m,message:R}):a&&F&&r?y.jsx(ne,{engine:a,definition:F,componentId:r.layout.root,enableErrorBoundary:f}):null;return f?y.jsx("div",{className:G,style:K,children:y.jsx(te,{componentId:r==null?void 0:r.layout.root,componentType:"PageContainer",onError:($,X)=>{console.error("页面容器错误:",$,X),i==null||i($.message)},children:V})}):y.jsx("div",{className:G,style:K,children:V})}function jr({schema:r,debug:t=!1}){return y.jsx(Ne,{schema:r,engineConfig:{debug:t},onPageLoad:s=>{t&&console.log("页面加载完成:",s.metadata)},onPageError:s=>{t&&console.error("页面加载失败:",s)}})}const wr="1.0.0";exports.ComponentRenderer=ne;exports.ErrorBoundary=te;exports.PageContainer=Ne;exports.SimpleComponentRenderer=Rr;exports.SimplePage=jr;exports.VERSION=wr;exports.useActionExecutor=Ye;exports.useBatchActionExecutor=hr;exports.useErrorBoundary=Sr;exports.usePageState=br;exports.usePageStates=Le;exports.useRenderEngine=ze;
